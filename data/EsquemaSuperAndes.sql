--- Sentencias SQL para la creación del esquema de parranderos

--Uso:
--Copie el contenido de este archivo y péguelo en una pestaña SQL de SQLDeveloper
--Ejecútelo como un script con el botón correspondiente

--Creación del secuenciador.
CREATE sequence SuperAndes_sequence;
--Creación de la tabla User y especificación de sus restricciones
CREATE TABLE USUARIO (id Number, password varchar(20), nombre varchar(40), correo varchar(30), tipo varchar(20),
CONSTRAINT USUARIO_PK PRIMARY KEY (id));

ALTER TABLE USUARIO
ADD CONSTRAINT USUARIO_TIPO 
CHECK (tipo IN ('empresa', 'persona'))
ENABLE;

--Creación de la tabla Empresas
CREATE TABLE EMPRESA (NIT Number, idUser Number, dir varchar(30), puntos Number, tipoEmpresa varchar(10),
CONSTRAINT EMPRESA_PK PRIMARY KEY (NIT));

ALTER TABLE EMPRESA
ADD CONSTRAINT EMPRESA_FK_idUser
FOREIGN KEY (idUser)
REFERENCES USUARIO
ENABLE;

ALTER TABLE EMPRESA
ADD CONSTRAINT EMPRESA_tipoEmpresa
CHECK (tipoEmpresa IN ('cliente', 'proveedor'))
ENABLE;

--Creación de la tabla Personas
CREATE TABLE PERSONA(cedula Number,idUser Number, puntos Number, idSucursal Number, tipoPersona varchar(10),
CONSTRAINT PERSONA_PK PRIMARY KEY (cedula));

ALTER TABLE PERSONA
ADD CONSTRAINT PERSONA_FK_idUser
FOREIGN KEY (idUser)
REFERENCES USUARIO
ENABLE;

ALTER TABLE PERSONA
ADD CONSTRAINT PERSONA_tipoPersona
CHECK (tipoPersona IN ('cliente', 'empleado_sucursal'))
ENABLE;


--Creación de la tabla Ciudad
CREATE TABLE CIUDAD(id Number, nombre varchar(30),
CONSTRAINT CIUDAD_PK PRIMARY KEY (id));

--Creación de la tabla Sucursales
CREATE TABLE SUCURSAL (id Number, nombre varchar (30), tamanho Number, direccion varchar(30), nivelReorden Number, nivelReabastecimiento Number, idCiudad Number,
CONSTRAINT SUCURSAL_PK PRIMARY KEY (id));

ALTER TABLE SUCURSAL 
ADD CONSTRAINT SUCURSAL_FK_idCiudad 
FOREIGN KEY (idCiudad)
REFERENCES CIUDAD
ENABLE;

--Creación de la tabla ProveedoresSucursales
CREATE TABLE PROVEEDORSUCURSAL(idSucursal Number, NITProveedor Number,
CONSTRAINT PROVEEDORSUCURSAL_PK PRIMARY KEY (idSucursal, NITProveedor));

ALTER TABLE PROVEEDORSUCURSAL
ADD CONSTRAINT PROVSUC_FK_idSucursal
FOREIGN KEY (idSucursal)
REFERENCES SUCURSAL
ENABLE;

ALTER TABLE PROVEEDORSUCURSAL
ADD CONSTRAINT PROVSUC_FK_NITProveedor
FOREIGN KEY (NITProveedor)
REFERENCES EMPRESA
ENABLE;

--Creación de la tabla A_CATEGORIA

CREATE TABLE CATEGORIA(nombre varchar(30), caracteristicas varchar(100), almacenamiento varchar(20), manejo varchar(40),
CONSTRAINT CATEGORIA_PK PRIMARY KEY (nombre));

ALTER TABLE CATEGORIA
ADD CONSTRAINT CATEGORIA_almacenamiento 
CHECK (almacenamiento IN ('Nevera', 'Granos', 'Cereales'));

--Creación de la tabla A_CONTENEDOR

CREATE TABLE CONTENEDOR(id Number, idSucursal Number, tipo varchar(20), capacidad Number, capacidadOcupada Number,
CONSTRAINT CONTENEDOR_PK PRIMARY KEY (id));

ALTER TABLE CONTENEDOR
ADD CONSTRAINT CONTENEDOR_FK_idSucursal
FOREIGN KEY (idSucursal)
REFERENCES SUCURSAL
ENABLE;

ALTER TABLE CONTENEDOR
ADD CONSTRAINT CONTENEDOR_tipo
CHECK (tipo IN ('estante', 'bodega'))
ENABLE;

ALTER TABLE CONTENEDOR
ADD CONSTRAINT CONTENEDOR_cap_vs_Ocup
CHECK (capacidadOcupada <= capacidad)
ENABLE;

--Creación de la tabla A_CARRITO

CREATE TABLE CARRITO(id Number, idUser Number,
CONSTRAINT CARRITO_PK PRIMARY KEY (id));

ALTER TABLE CARRITO
ADD CONSTRAINT CARRITO_FK_NITProveedor
FOREIGN KEY (idUser)
REFERENCES USUARIO
ENABLE;


--Creación de la tabla A_PRODUCTOABSTRACTO
CREATE TABLE PRODUCTOABSTRACTO(id Number, nombre varchar(30), tipo varchar(20), unidadMedida varchar(2), categoria varchar(30),
CONSTRAINT PRODUCTOABSTRACTO_PK PRIMARY KEY (id));

ALTER TABLE PRODUCTOABSTRACTO
ADD CONSTRAINT PRODUCTOABSTRACTO_FK_categoria
FOREIGN KEY (categoria)
REFERENCES CATEGORIA
ENABLE;

--Creación de la tabla OfrecidosSucursales
CREATE TABLE OFRECIDOSUCURSAL(id Number, idAbstracto Number, idSucursal Number, precio Number,
CONSTRAINT OFRECIDOSUCURSAL_PK PRIMARY KEY (id));

ALTER TABLE OFRECIDOSUCURSAL
ADD CONSTRAINT OFRECSUC_FK_idSucursal
FOREIGN KEY (idSucursal)
REFERENCES SUCURSAL
ENABLE;

ALTER TABLE OFRECIDOSUCURSAL
ADD CONSTRAINT OFRECSUC_FK_idAbstracto
FOREIGN KEY (idAbstracto)
REFERENCES PRODUCTOABSTRACTO
ENABLE;

--Creación de la tabla A_OFRECIDOPROVEEDOR
CREATE TABLE OFRECIDOPROVEEDOR(id Number, idAbstracto Number, NITProveedor Number, precio Number,
CONSTRAINT OFRECIDOPROVEEDOR_PK PRIMARY KEY (id));

ALTER TABLE OFRECIDOPROVEEDOR
ADD CONSTRAINT OFRECPROV_FK_NIT
FOREIGN KEY (NITProveedor)
REFERENCES EMPRESA
ENABLE;

ALTER TABLE OFRECIDOPROVEEDOR
ADD CONSTRAINT OFRECPROV_FK_idAbstracto
FOREIGN KEY (idAbstracto)
REFERENCES PRODUCTOABSTRACTO
ENABLE;

--Creación de la tabla A_PRODUCTOFISICO
CREATE TABLE PRODUCTOFISICO(id Number, idOfrecido Number, cantidadMedida Number, codigoBarras varchar(20), idContenedor Number, idCarrito Number,
CONSTRAINT PRODUCTOFISICO_PK PRIMARY KEY (id));

ALTER TABLE PRODUCTOFISICO
ADD CONSTRAINT PRODUCTOFISICO_FK_idOfrecido
FOREIGN KEY (idOfrecido)
REFERENCES OFRECIDOSUCURSAL
ENABLE;

ALTER TABLE PRODUCTOFISICO
ADD CONSTRAINT PRODUCTOFISICO_FK_idContenedor
FOREIGN KEY (idContenedor)
REFERENCES CONTENEDOR
ENABLE;

ALTER TABLE PRODUCTOFISICO
ADD CONSTRAINT PRODUCTOFISICO_FK_idCarrito
FOREIGN KEY (idCarrito)
REFERENCES CARRITO
ENABLE;
--Falta la parte de hexadecimales en el código de barras.



--Creación de tabla Pedido
CREATE TABLE PEDIDO  (id Number, idSucursal Number, NITProveedor Number, precio Number, estado varchar(10), fechaEntrega varchar(10), calidad varchar(15), calificacion Number,
CONSTRAINT PEDIDO_PK PRIMARY KEY (id));

ALTER TABLE PEDIDO
ADD CONSTRAINT PEDIDO_FK_idSucursal
FOREIGN KEY (idSucursal)
REFERENCES SUCURSAL
ENABLE;

ALTER TABLE PEDIDO
ADD CONSTRAINT PEDIDO_FK_NITProveedor
FOREIGN KEY (NITProveedor)
REFERENCES EMPRESA
ENABLE;

ALTER TABLE PEDIDO
ADD CONSTRAINT PEDIDO_estado
CHECK (estado IN('entregado', 'por_entregar'))
ENABLE;

ALTER TABLE PEDIDO
ADD CONSTRAINT PEDIDO_calidad
CHECK (calidad IN ('muy_mala', 'mala', 'regular', 'buena', 'muy_buena'))
ENABLE;

ALTER TABLE PEDIDO
ADD CONSTRAINT PEDIDO_calificacion
CHECK (calificacion IN (1,2,3,4,5))
ENABLE;

--Creación de tabla A_PRODUCTOPEDIDO
CREATE TABLE PRODUCTOPEDIDO(idPedido Number, idProductoOfrecido Number, cantidad Number,
CONSTRAINT PRODUCTOPEDIDO_PK PRIMARY KEY (idPedido, idProductoOfrecido));

ALTER TABLE PRODUCTOPEDIDO
ADD CONSTRAINT PRODPEDIDO_FK_idPedido
FOREIGN KEY (idPedido)
REFERENCES PEDIDO
ENABLE;

ALTER TABLE PRODUCTOPEDIDO
ADD CONSTRAINT PRODPEDIDO_FK_idOfrecido
FOREIGN KEY (idProductoOfrecido)
REFERENCES OFRECIDOPROVEEDOR
ENABLE;

--Creación de tabla Promociones
CREATE TABLE PROMOCION(id Number, idSucursal Number, descripcion varchar(130), tipo varchar(20),
CONSTRAINT PROMOCION_PK PRIMARY KEY (id));

ALTER TABLE PROMOCION
ADD CONSTRAINT PROMOCION_FK_idSucursal
FOREIGN KEY (idSucursal)
REFERENCES SUCURSAL
ENABLE;

ALTER TABLE PROMOCION
ADD CONSTRAINT PROMOCION_tipo
CHECK (tipo IN ('pague_n_lleve_m', 'pague_x_lleve_y', 'porcentaje_descuento', 'paquete_productos'))
ENABLE;

--Creación de tabla PromocionesPorCantidadOUnidad
CREATE TABLE PROMPORCANTIDADOUNIDAD(idProductoOfrecido Number, idPromocion Number, cantidadOUnidadesPagadas Number, cantidadOUnidadesCompradas Number,
CONSTRAINT PROMCANTIDADOUNIDAD_PK PRIMARY KEY (idProductoOfrecido));--Revisar <-- <-- <-- <--

ALTER TABLE PROMPORCANTIDADOUNIDAD
ADD CONSTRAINT PROMCANTOUNID_FK_idOfrecido
FOREIGN KEY (idProductoOfrecido)
REFERENCES OFRECIDOSUCURSAL
ENABLE;

ALTER TABLE PROMPORCANTIDADOUNIDAD
ADD CONSTRAINT PROMCANTOUNID_FK_idProm
FOREIGN KEY (idPromocion)
REFERENCES PROMOCION
ENABLE;

--Creación de la tabla PromocionesPorcentajeDescuento
CREATE TABLE PROMPORCENTAJEDESCUENTO(idProductoOfrecido Number, idPromocion Number, porcentajeDescuento Number,
CONSTRAINT PROMPORCENTAJEDESCUENTO_PK PRIMARY KEY (idProductoOfrecido ));

ALTER TABLE PROMPORCENTAJEDESCUENTO
ADD CONSTRAINT PROMPORCDESC_FK_idOfrecido
FOREIGN KEY (idProductoOfrecido)
REFERENCES OFRECIDOSUCURSAL
ENABLE;

ALTER TABLE PROMPORCENTAJEDESCUENTO
ADD CONSTRAINT PROMPORCDESC_FK_idProm
FOREIGN KEY (idPromocion)
REFERENCES PROMOCION
ENABLE;

--Creación de la tabla PromocionesPaqueteProductos
CREATE TABLE PROMPAQUETEPRODUCTOS(idPromocion Number, precio Number, idProductoOfrecido1 Number, idProductoOfrecido2 Number,
CONSTRAINT PROMPAQUETEPRODUCTOS_PK PRIMARY KEY(idProductoOfrecido1, idProductoOfrecido2));

ALTER TABLE PROMPAQUETEPRODUCTOS
ADD CONSTRAINT PROMPAQPROD_FK_idProm
FOREIGN KEY (idPromocion)
REFERENCES PROMOCION
ENABLE;

ALTER TABLE PROMPAQUETEPRODUCTOS
ADD CONSTRAINT PROMPAQPROD_FK_idOfrecido1
FOREIGN KEY (idProductoOfrecido1)
REFERENCES OFRECIDOSUCURSAL
ENABLE;

ALTER TABLE PROMPAQUETEPRODUCTOS
ADD CONSTRAINT PROMPAQPROD_FK_idOfrecido2
FOREIGN KEY (idProductoOfrecido2)
REFERENCES OFRECIDOSUCURSAL
ENABLE;

--Creación de tabla Facturas
CREATE TABLE FACTURA(id Number, idUser Number, costoTotal Number,
CONSTRAINT FACTURA_PK PRIMARY KEY (id));

ALTER TABLE FACTURA
ADD CONSTRAINT FACTURA_FK_idUser
FOREIGN KEY (idUser)
REFERENCES USUARIO
ENABLE;

--Creación de tabla ItemsFacturas
CREATE TABLE ITEMFACTURA(idFactura Number, idProductoOfrecido Number, cantidad Number, costo Number,
CONSTRAINT ITEMFACTURA_PK PRIMARY KEY (idFactura, idProductoOfrecido));

ALTER TABLE ITEMFACTURA
ADD CONSTRAINT ITEMFACTURA_FK_idFactura
FOREIGN KEY (idFactura)
REFERENCES FACTURA
ENABLE;

ALTER TABLE ITEMFACTURA
ADD CONSTRAINT ITEMFACTURA_FK_idOfrecido
FOREIGN KEY (idProductoOfrecido)
REFERENCES OFRECIDOSUCURSAL
ENABLE;

COMMIT;